{"version":3,"sources":["../../src/pages/settings/settings.module.ts","../../src/pages/settings/settings.ts"],"names":[],"mappings":"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","file":"4.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { SettingsPage } from './settings';\n\n@NgModule({\n  declarations: [\n    SettingsPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(SettingsPage),\n  ],\n})\nexport class SettingsPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/settings/settings.module.ts","import { Component } from '@angular/core';\nimport { AlertController, Events, IonicPage, LoadingController, NavController, NavParams, ToastController, ViewController } from 'ionic-angular';\nimport { AuthHelperProvider } from '../../providers/auth-helper/auth-helper';\nimport { ProfileProvider } from '../../providers/profile/profile';\nimport 'rxjs/add/operator/finally';\nimport { UsersProvider } from '../../providers/users/users';\nimport { StaticDataProvider } from '../../providers/static-data/static-data';\nimport { ValidateProvider } from '../../providers/validate/validate';\n\n@IonicPage()\n@Component({\n  selector: 'page-settings',\n  templateUrl: 'settings.html'\n})\nexport class SettingsPage {\n\n  isLoading = false;\n  profileData;\n  dronesArray = this.staticDataProvider.getDronesArray();\n  profilePictureEncoded = '';\n  profilePictureFile: File;\n\n  constructor(public navCtrl: NavController,\n              public navParams: NavParams,\n              public viewCtrl: ViewController,\n              public authHelperProvider: AuthHelperProvider,\n              public profileProvider: ProfileProvider,\n              public usersProvider: UsersProvider,\n              public staticDataProvider: StaticDataProvider,\n              public alertCtrl: AlertController,\n              public toastCtrl: ToastController,\n              public validateProvider: ValidateProvider,\n              public loadingCtrl: LoadingController,\n              public events: Events) {\n  }\n\n  dismiss() {\n    this.viewCtrl.dismiss();\n  }\n\n  ionViewDidLoad() {\n  }\n\n  ionViewWillEnter() {\n    this.getProfileData();\n  }\n\n  async getProfileData() {\n    let { username } = await this.authHelperProvider.getDecodedAuthToken();\n    this.isLoading = true;\n    let loading = this.loadingCtrl.create({ content: 'Loading...' });\n    loading.present();\n    this.profileProvider.getProfile(username)\n      .finally(() => {\n        this.isLoading = false;\n        loading.dismiss();\n      })\n      .subscribe((response) => {\n        this.profileData = response.data;\n        let oldDronesArray = [];\n        this.profileData['drones'].forEach((drone, index) => {\n          oldDronesArray.push(this.dronesArray.indexOf(drone));\n        });\n        this.profileData['drones'] = oldDronesArray;\n        this.profileData['profilePicUrl'] = this.usersProvider.getProfilePicUrl(this.profileData['_id']);\n        console.log(JSON.stringify(this.profileData));\n      }, (error) => {\n        this.toastCtrl.create({ message: `Couldn't get fresh profile data :/`, duration: 2000 }).present();\n      });\n  }\n\n  onProfilePictureSelected(ev) {\n    const candidateFile = ev.target.files[0];\n    if (candidateFile) {\n      const profilePictureValidator = this.validateProvider.validateProfilePicture(candidateFile);\n      if (!profilePictureValidator.isValid) {\n        return this.toastCtrl.create({\n          message: profilePictureValidator.msg,\n          duration: 3000\n        }).present();\n      }\n      this.profilePictureFile = candidateFile;\n      const fileReader: FileReader = new FileReader();\n      fileReader.readAsDataURL(this.profilePictureFile);\n      fileReader.onload = (e) => {\n        this.profilePictureEncoded = fileReader.result;\n      };\n    }\n  }\n\n  openConfirmation() {\n    let alert = this.alertCtrl.create({\n      title: 'Confirm',\n      message: 'Please enter your current password',\n      inputs: [\n        {\n          name: 'passwordOldConfirm',\n          placeholder: 'Current password',\n          type: 'password',\n          checked: true\n        }\n      ],\n      buttons: [\n        {\n          text: 'Cancel',\n          role: 'cancel'\n        },\n        {\n          text: 'Edit',\n          handler: (data) => {\n            if (data.passwordOldConfirm && data.passwordOldConfirm.length) {\n              this.handleProfileEdit(data.passwordOldConfirm);\n            } else {\n              this.toastCtrl.create({ message: 'Please provide a confirm password!', duration: 150000 }).present();\n            }\n          }\n        }\n      ]\n    });\n    alert.present();\n  }\n\n  handleProfileEdit(oldPassword) {\n    const editInputValidator = this.validateProvider.validateRegisterInput(this.profileData, true);\n    if (!editInputValidator.isValid) {\n      return this.toastCtrl.create({ message: editInputValidator.msg, duration: 1500 }).present();\n    }\n    const editFormData: FormData = new FormData();\n    const objToSend = {\n      firstName: this.profileData.firstName,\n      lastName: this.profileData.lastName,\n      email: this.profileData.email,\n      username: this.profileData.username,\n      password: this.profileData.password,\n      drones: this.profileData.drones,\n      oldPassword: oldPassword,\n      about: this.profileData.about\n    };\n\n    editFormData.append('data', JSON.stringify(objToSend));\n\n    if (this.profilePictureFile) {\n      editFormData.append('profilePicture', this.profilePictureFile);\n    }\n\n    this.profileProvider.editProfileInfo(editFormData).subscribe((response) => {\n      if (response.success) {\n        this.authHelperProvider.loginUser(response.token);\n        this.events.publish('profile:change');\n        this.dismiss();\n      }\n    }, (error) => {\n      return this.toastCtrl.create({ message: error.parsedBody.msg || 'An error occurred', duration: 1500 }).present();\n    });\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/settings/settings.ts"],"sourceRoot":""}